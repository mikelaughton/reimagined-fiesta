{% extends "reminders/base_masonry.html" %}
{% load static i18n %}
{% get_media_prefix as media_prefix %}

{% block title %} Adulting {% endblock %}
{% block style %}
		.grid { max-width: 98%; margin: 1% auto; }
		.grid-item { margin-bottom: 2%; }
		.grid-sizer { width: 25%; }
		@media screen and (min-width: 1025px) {
			/*guttering be hard, yo.*/
		.grid-item { width: calc(25% - 2%); }
		}
		@media screen and (max-width: 1024px) {
		  .grid-sizer{ width: 33%; }
		  .grid-item { width: calc(33.3333% - 2%); }	
		}
		@media screen and (max-width: 768px) {
		.grid-item { width: 100%; }
		}
		.activity-group { 
						//squish that padding in there
						box-sizing: border-box; 
						padding: 1%; 
						} 	
		.task-red { background-color: #F44336; 
					color: white;
					 }
		.task-red a { color: #FFEF86; }
		.task-yellow { background-color: #FFEB3B;
						color: black;
						}
		.task-blue { 
					background-color: #2196F3;
					color: white;
					}
		.task-blue a { color: #FFD727; }
		.task-green {
					background-color: #4CAF50;
					color: white;
					 }
		.task-green a { color: #A9E2AD; }
{% endblock %}
{% block extra_head %}
		<script>
			//Probably best putting this in an external script. Thanks Django docs!
			function getCookie(name) {
				var cookieValue = null;
				if (document.cookie && document.cookie !== '') {
					var cookies = document.cookie.split(';');
					for (var i = 0; i < cookies.length; i++) {
						var cookie = jQuery.trim(cookies[i]);
						// Does this cookie string begin with the name we want?
						if (cookie.substring(0, name.length + 1) === (name + '=')) {
						    cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
						    break;
						}
					}
				}
				return cookieValue;
			}
			var csrftoken = getCookie('csrftoken');

			$(document).ready(function(){
				$("a.btn").click(function(e){
					e.preventDefault(); console.log(e.target.href);
					t = $.post(e.target.href,{the_task:e.target.href[-1], csrfmiddlewaretoken: csrftoken });
					console.log(t.responseText);
					/* Fix this so that it doesn't do it to countdown ones... */
					$(this).closest("div.activity-group").find("time").first().text("0 {% trans 'seconds' noop %}");
					console.log(this);
					console.log($(this).parent());
					console.log($(this).parent().parent().children("time"));
					/*btn = e.target.id;
					$(btn.id).removeClass("btn-success");
					$(btn.id).addClass("btn-neutral");
					t = $.load($(btn.id).href);
					newClass = (t == "Hurray") ? "btn-success" : "btn-warning";
					$(btn.id).removeClass("btn-neutral");
					$(btn.id).addClass(newClass)*/
			});
			$(".grid").masonry({
				itemSelector: '.grid-item',
				columnWidth: '.grid-sizer',
				percentPosition: true });
			});
		</script>
{% endblock %}
{% block content %}
		<div class="grid">
		<div class="grid-sizer"></div>
		<div class="gutter-sizer"></div>
		<!-- begin row -->
{% for task in tasks %}
			<div class="grid-item">
			<div class="activity-group well task-{{task.colour}}" id="task_{{ task.pk }}">
				<h1 class="activity_title">
					<a href="{% url 'reminders:detail' pk=task.pk %}">{{task.label}}</a>
				</h1>
				<img src="{% get_media_prefix %}/{{task.icon.icon}}" alt="{{task.icon}}">
				<p class="time">
					{% if task.countdown %}					
					<time>{{ task.deadline|timeuntil }}</time> <span class="ancillary">{% trans 'until' noop %}</span> <time>{{ task.deadline }}</time> 
					{% else %}
						{% if task.last_performed|date|length > 0 %}
						<time>{{ task.last_performed|timesince }}</time> <span class="ancillary">{% trans 'since you last did it' noop %}</span>.
						{% else %}
						{% trans 'Not yet performed' noop %}.
						{% endif %}
					{% endif %} 
				</p>
				<p><a href="{% url 'reminders:perform' task_id=task.pk %}" class="btn btn-success">Done</a></p>
			</div>
			</div>
			<!-- end bootstrap spacing -->
{% endfor %}
			<div class="grid-item">
				<div class="activity-group well task-create">
					<h1>{% trans 'Create reminder' %}</h1>
					<p style="font-size:400%;"><a href="{% url 'reminders:create' %}">+</a></p>
				</div>
			</div>
		<!-- end .row -->
		</div>
{% endblock %}
